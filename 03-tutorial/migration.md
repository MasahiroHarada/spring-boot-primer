# DB マイグレーション

## DB マイグレーションとは

DB マイグレーションとは、テーブル定義を管理する仕組みのことです。

アプリケーションを開発するにあたって、テーブル定義はしばしば変更されるものです。実装着手前の設計段階で変更のない完璧なテーブル定義を作成することは不可能です。初期フェーズの開発中においてさえ設計の変更（テーブルやカラムの追加）は発生しますし、リリースした後もアプリケーションの成長（＝機能追加、仕様変更）に合わせてテーブル定義も当然変化します。

そこで、変遷するテーブル定義を管理する必要が出てきます。DB マイグレーションツールはたいてい、**どのような SQL をどの順番で実行したか**を管理します。そして実行される SQL 文[^1]はアプリケーションのプロジェクトディレクトリに含まれます。つまりアプリケーションコードと同様に**バージョン管理下に置かれ共有される**ということです。

ある環境にアプリケーションをリリースするときやチームに新しいメンバーを迎えるとき、このようにテーブル定義の管理がされていると、データベースをあるべき状態に再現することが容易になります。

[^1]: マイグレーションツールによっては SQL 文ではなく、独自のクラスや設定ファイルでテーブルの状態や変更を表現する場合もあります。

## Flyway

DB マイグレーションを実現するためのライブラリはいくつかあるようですが、今回はその中で **Flyway** というライブラリを使用します。

```src/main/resources``` の下に ```db/migration``` というディレクトリを作成してください。そしてそのなかに ```V1__Create_members.sql``` というファイルを作成してください。Flyway の仕様としてこのファイル名が重要な意味を持つので注意しましょう。

```
V{バージョン番号}__{任意の名前}.sql
```

```V``` は大文字で、バージョン番号の右のアンダースコアは2つ必要です。

SQL ファイルが作成できたら、テーブル定義のページで考えた通りの DDL を記述しましょう。

```sql
CREATE TABLE members (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL
);
```

TODO