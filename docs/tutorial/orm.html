<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Object-Relational マッピング | Spring Boot 入門</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/spring-boot-primer/assets/css/0.styles.9f3a32a1.css" as="style"><link rel="preload" href="/spring-boot-primer/assets/js/app.dc92be2a.js" as="script"><link rel="preload" href="/spring-boot-primer/assets/js/26.16eb78a8.js" as="script"><link rel="prefetch" href="/spring-boot-primer/assets/js/4.a86bd645.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/2.e3abbe1b.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/3.6e084602.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/5.c7131078.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/6.1584f20b.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/7.3a5c5656.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/8.76902ef0.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/9.06eb8fa2.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/10.e09f378e.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/11.e9b1c808.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/12.f63a1b96.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/13.9f07f086.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/14.0c1ac32a.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/15.c77ef358.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/16.3d40a751.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/17.db41ec13.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/18.429ef17e.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/19.9eef03f2.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/20.9f6de086.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/21.d99a1883.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/22.6c4fa71d.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/23.dcb8ebe9.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/24.ea749d2d.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/25.858b3b8e.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/27.8f2f2af1.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/28.1ef1931d.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/29.54c1e6b5.js"><link rel="prefetch" href="/spring-boot-primer/assets/js/30.91b69efb.js">
    <link rel="stylesheet" href="/spring-boot-primer/assets/css/0.styles.9f3a32a1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/spring-boot-primer/" class="home-link router-link-active"><!----><span class="site-name">
      Spring Boot 入門
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/spring-boot-primer/settings/" class="nav-link">開発環境構築</a></div><div class="nav-item"><a href="/spring-boot-primer/hello-world/" class="nav-link">Hello world!</a></div><div class="nav-item"><a href="/spring-boot-primer/tutorial/" class="nav-link router-link-active">チュートリアル</a></div><div class="nav-item"><a href="/spring-boot-primer/practice/" class="nav-link">演習問題</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/spring-boot-primer/settings/" class="nav-link">開発環境構築</a></div><div class="nav-item"><a href="/spring-boot-primer/hello-world/" class="nav-link">Hello world!</a></div><div class="nav-item"><a href="/spring-boot-primer/tutorial/" class="nav-link router-link-active">チュートリアル</a></div><div class="nav-item"><a href="/spring-boot-primer/practice/" class="nav-link">演習問題</a></div><!----></nav><ul class="sidebar-links"><li><a href="/spring-boot-primer/tutorial/" class="sidebar-link">チュートリアル</a></li><li><a href="/spring-boot-primer/tutorial/sample-application.html" class="sidebar-link">サンプルアプリについて</a></li><li><a href="/spring-boot-primer/tutorial/database-design.html" class="sidebar-link">テーブル定義</a></li><li><a href="/spring-boot-primer/tutorial/url-design.html" class="sidebar-link">URL設計</a></li><li><a href="/spring-boot-primer/tutorial/migration.html" class="sidebar-link">DB マイグレーション</a></li><li><a href="/spring-boot-primer/tutorial/orm.html" class="active sidebar-link">Object-Relational マッピング</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring-boot-primer/tutorial/orm.html#object-relational-マッピングとは" class="sidebar-link">Object-Relational マッピングとは</a></li><li class="sidebar-sub-header"><a href="/spring-boot-primer/tutorial/orm.html#ドメインクラス" class="sidebar-link">ドメインクラス</a></li><li class="sidebar-sub-header"><a href="/spring-boot-primer/tutorial/orm.html#mybatis" class="sidebar-link">MyBatis</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring-boot-primer/tutorial/orm.html#mapper-インターフェース" class="sidebar-link">Mapper インターフェース</a></li><li class="sidebar-sub-header"><a href="/spring-boot-primer/tutorial/orm.html#xmlでのマッピング" class="sidebar-link">XMLでのマッピング</a></li><li class="sidebar-sub-header"><a href="/spring-boot-primer/tutorial/orm.html#まとめると" class="sidebar-link">まとめると</a></li></ul></li></ul></li><li><a href="/spring-boot-primer/tutorial/modify-controller.html" class="sidebar-link">コントローラーを作成する</a></li><li><a href="/spring-boot-primer/tutorial/thymeleaf.html" class="sidebar-link">テンプレートを追加する</a></li><li><a href="/spring-boot-primer/tutorial/all-members.html" class="sidebar-link">メンバー一覧を表示する</a></li><li><a href="/spring-boot-primer/tutorial/search-functionality.html" class="sidebar-link">検索機能を実装しよう</a></li><li><a href="/spring-boot-primer/tutorial/add-member-functionality.html" class="sidebar-link">メンバー追加機能を実装しよう</a></li></ul></div><div class="page"><div class="content"><h1 id="object-relational-マッピング"><a href="#object-relational-マッピング" aria-hidden="true" class="header-anchor">#</a> Object-Relational マッピング</h1><p>前のページでアプリケーションで使うテーブルが揃いました。</p><p>このページではアプリケーションからそのテーブルのデータを操作するためのコードを追加します。少し難しいですが、頑張ってください。全体が見えてからのもう一度読み直すと理解しやすいかもしれません。</p><h2 id="object-relational-マッピングとは"><a href="#object-relational-マッピングとは" aria-hidden="true" class="header-anchor">#</a> Object-Relational マッピングとは</h2><p>Object-Relational マッピング（ORM）とは、アプリケーションからデータベースの操作をしやすくするためのプログラミング手法です。</p><p>オブジェクト指向モデルであるアプリケーション（例：Java）とリレーショナルデータベース（例：PostgreSQL）では、そもそもデータの持ち方が違います。</p><p>オブジェクト指向では、クラスがあってプロパティにデータを持ちます。例えば以下のように。</p><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String email<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String password<span class="token punctuation">;</span>
    <span class="token comment">// 中略</span>
<span class="token punctuation">}</span>
</code></pre></div><p>一方リレーショナルモデルでは行と列、つまりテーブルでデータを持ちます。</p><div class="language- extra-class"><pre class="language-text"><code>users テーブル
| email           | password |
|-----------------|----------|
| sample@mail.com | test1234 |
</code></pre></div><p>例えば <code>users</code> テーブルから取得したデータを、毎回 <code>User</code> クラスに詰めなおすのは面倒ですね。<code>User</code> クラスのデータを <code>user</code> テーブルに挿入したい場合も、いちいちプロパティからデータを引っ張ってきて INSERT 文を作るのは面倒です。そこであらかじめアプリ側のデータとテーブル側のデータの紐づけを定義しておこうというのが ORM です。</p><p>言葉だけでは理解が難しいと思いますので、コードを書きながら ORM の働きを体得してください。</p><h2 id="ドメインクラス"><a href="#ドメインクラス" aria-hidden="true" class="header-anchor">#</a> ドメインクラス</h2><p>まず Java 側でデータを入れる箱になるクラスを用意しましょう。このような役割を持つクラスをドメインクラスやエンティティクラス、モデルクラスなどと呼びます。</p><p><code>com.example.search</code> 配下に <code>domains</code> パッケージを新たに作成してください。そしてそこに <code>Member.java</code> クラスファイルを作成しましょう。</p><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>search<span class="token punctuation">.</span>domains<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Member</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">Member</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ここでまた便利なショートカットキーを紹介します。コンストラクタやゲッター・セッターを自動生成するショートカットです。<code>Ctrl + Alt + S</code> を入力してください。以下のダイアログが表示されるでしょう。</p><p><img src="/spring-boot-primer/assets/img/sts-generate-code.2b050783.png" alt="STS Generate code"></p><p>「Generate Getters and Setters...」や「Generate Constructor using Fields...」を選ぶと対象のプロパティを聞かれるので、チェックを入れて「Finish」をクリックするとコードが自動生成されます。</p><p>またここまで読んで、<strong>ドメインクラスひとつがテーブルひとつに対応する</strong>ように作ればいいのか、と考えた方もいるでしょうか。基本的にはその通りです。複雑なアプリケーションになるともちろん例外も出てきますが、まずはテーブルに対応するドメインクラス（またはエンティティまたはモデル）を作成する認識で OK です。</p><h2 id="mybatis"><a href="#mybatis" aria-hidden="true" class="header-anchor">#</a> MyBatis</h2><p>ORM ライブラリも言語やフレームワークによっていろいろ存在します。Java の世界でもいくつか選択肢がありますが、今回は <strong>MyBatis</strong> というライブラリを使用します。</p><p>ここからは MyBatis での実装方法です。ライブラリが変われば実装方法も変わります（ドメインクラスはどのような ORM ライブラリでも大体必要になる）。</p><p>また、まずは member テーブルの一覧を取得する機能から実装していく前提で進めます。</p><h3 id="mapper-インターフェース"><a href="#mapper-インターフェース" aria-hidden="true" class="header-anchor">#</a> Mapper インターフェース</h3><p>Java から SQL を発行するための仲介役となるインターフェースおよびメソッドを定義します。</p><p>どういうことかというと、</p><div class="language-java extra-class"><pre class="language-java"><code>db<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM members&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ORM の考え方では上記のような書き方はしないのです。リレーショナルの世界の言葉（SQL）がオブジェクト指向の世界（Java）に入り込んでしまっていて良くないと考えられます。</p><p>その代わり Mapper を介して、</p><div class="language-java extra-class"><pre class="language-java"><code>memberMapper<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>と書けたほうが、簡単にいうと「Javaっぽくてカッコよくね」というわけです。この <code>all</code> メソッドを呼んだときに実際にどのような SQL が発行されるかは後述の XML で定義します。</p><p><code>com.example.search</code> 配下に <code>mappers</code> パッケージを新たに作成してください。そしてそこに <code>MemberMapper.java</code> インターフェースファイルを作成しましょう。</p><p>クラスではなく<strong>インターフェース</strong>なので注意してください。</p><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>search<span class="token punctuation">.</span>mappers<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span>Mapper<span class="token punctuation">;</span>

<span class="token keyword">import</span> com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>search<span class="token punctuation">.</span>domains<span class="token punctuation">.</span>Member<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MemberMapper</span> <span class="token punctuation">{</span>
    List<span class="token generics function"><span class="token punctuation">&lt;</span>Member<span class="token punctuation">&gt;</span></span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>新しいアノテーション「@Mapper」が登場しましたね。「@Mapper」アノテーションをインターフェースに付加すると、コンパイル時に以下で説明する XML ファイルを読み込んで自動的に具象クラスが作成されます。</p><p>ちょっと不思議な感じがするかもしれませんが、最初はそういうもんだと思ってパターンを覚えてしまえばいいでしょう。</p><h3 id="xmlでのマッピング"><a href="#xmlでのマッピング" aria-hidden="true" class="header-anchor">#</a> XMLでのマッピング</h3><p>MyBatis では「アプリ側のデータとテーブル側のデータの紐づけを定義」を XML ファイルで行います。</p><p><code>src/main/resources</code> の下にさらに <code>com/example/search/mappers</code> というディレクトリ[^1]を作成します。ディレクトリができたらその中に <code>MemberMapper.xml</code> というファイルを作成し、以下の内容を記述してください。</p><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token doctype">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.example.search.mappers.MemberMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 結果と結果を受け取るクラスの紐づけ --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>memberResultMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.example.search.domains.Member<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- SQL --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>all<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>memberResultMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        SELECT * FROM members
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>[^1]: ディレクトリが重要なので間違わないように注意してください。つまり Mapper インターフェースのパッケージ名「com.example.search.mappers」に合わせたディレクトリ階層にするということです。このルールを守ることで自動的に XML ファイルを検出して読み込んでくれるらしいです。設定で変更することもできるようですが今回は MyBatis の詳細な設定方法までは追いません。</p><p>XML ファイルの内容を説明していきます。</p><h4 id="mapper"><a href="#mapper" aria-hidden="true" class="header-anchor">#</a><code>&lt;mapper&gt;</code></h4><p>まずルート要素は <code>&lt;mapper&gt;</code> です。<code>namespace</code> 属性に対応するインターフェースの名前空間を記述しましょう。</p><p><code>&lt;mapper&gt;</code> の子要素が2つありますね。<code>&lt;resultMap&gt;</code> と <code>&lt;select&gt;</code> です。</p><h4 id="resultmap"><a href="#resultmap" aria-hidden="true" class="header-anchor">#</a><code>&lt;resultMap&gt;</code></h4><p><code>&lt;resultMap&gt;</code> は「クエリ結果のどのカラムとクラスのどのプロパティが紐づくか」を定義します。</p><ul><li><code>id</code> 属性は後で他の要素から参照するときに使用する ID です。</li><li><code>type</code> 属性はアプリ側のデータの入れ物クラス＝ドメインクラスの型名です。<code>com</code> からの完全修飾名でなくてはいけませんので注意してください。</li></ul><p><code>&lt;resultMap&gt;</code> の中には <code>&lt;result&gt;</code> が並びます。<code>property</code> と <code>column</code> という2つの属性を持っています。</p><ul><li><code>property</code> 属性にはクラスのプロパティ名を記述します。</li><li><code>column</code> 属性にはクエリ結果のカラム名を記述します。</li></ul><h4 id="select"><a href="#select" aria-hidden="true" class="header-anchor">#</a><code>&lt;select&gt;</code></h4><p><code>&lt;select&gt;</code> は「Mapper のメソッドと SQL の紐づき」を定義します。</p><p><code>id</code> と <code>resultMap</code> という2つの属性が定義されていますね。</p><ul><li><code>id</code> 属性には Mapper 側のメソッド名を記述します。</li><li><code>resultMap</code> 属性には SELECT 文の結果をどのクラスにどのように紐づけるかを定義します。ここで <code>&lt;resultMap&gt;</code> の <code>id</code> を参照するわけです。</li></ul><p><code>&lt;select&gt;</code> の中には実行したい SQL 文（<code>&lt;select&gt;</code> なので SELECT 文）を記述します。</p><h4 id="参考"><a href="#参考" aria-hidden="true" class="header-anchor">#</a> 参考</h4><p>http://www.mybatis.org/mybatis-3/ja/sqlmap-xml.html#Result_Maps</p><h3 id="まとめると"><a href="#まとめると" aria-hidden="true" class="header-anchor">#</a> まとめると</h3><h4 id="処理の流れ"><a href="#処理の流れ" aria-hidden="true" class="header-anchor">#</a> 処理の流れ</h4><ol><li><code>memberMapper.all()</code> を実行する。</li><li>XML で定義された通り、<code>&lt;select id=&quot;all&quot;&gt;</code> の中の SQL（<code>SELECT * FROM members</code>）が発行される。</li><li>クエリの結果が返ってくる。</li><li>クエリの結果をどのようにマッピングするかは、<code>&lt;select&gt;</code> の <code>resultMap</code> 属性に書いてある。ここでは <code>memberResultMap</code> と記述されているので、<code>id</code> が <code>memberResultMap</code> である <code>&lt;resultMap&gt;</code> 要素を参照する。</li><li><code>&lt;resultMap id=&quot;memberResultMap&quot;&gt;</code> を参照すると、クエリ結果の <code>id</code> を <code>Member</code> クラスの <code>id</code> プロパティに、クエリ結果の <code>name</code> を <code>name</code> プロパティに紐づけるよう定義されている。</li><li>定義の通りにクエリの結果データが格納されたクラスのインスタンスが生成される。クエリの結果行ごとにインスタンスは生成される。</li><li>Mapper では <code>all</code> の戻り値は <code>List&lt;Member&gt;</code> と定義しているため、<code>Member</code> インスタンスが結果行数ぶん入った
<code>List</code> が <code>all</code> メソッドの呼び出し元に返却される。</li></ol><p>文字にすると一見ややこしいようですがロジックやアルゴリズムの問題ではなく、ライブラリのルールとしてどことどこが紐づくかというパズルでしかないので落ち着いて取り組んでみてください。</p><h4 id="余談"><a href="#余談" aria-hidden="true" class="header-anchor">#</a> 余談</h4><p>XML ファイルでマッピングを定義するのは ORM ライブラリの中でも珍しいのではと思います。ただ社内の割と大規模な受託プロジェクトで採用していると聞いたので取り上げました。</p></div><div class="page-edit"><!----><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/spring-boot-primer/tutorial/migration.html" class="prev">
          DB マイグレーション
        </a></span><span class="next"><a href="/spring-boot-primer/tutorial/modify-controller.html">
          コントローラーを作成する
        </a> →
      </span></p></div></div></div></div>
    <script src="/spring-boot-primer/assets/js/26.16eb78a8.js" defer></script><script src="/spring-boot-primer/assets/js/app.dc92be2a.js" defer></script>
  </body>
</html>
